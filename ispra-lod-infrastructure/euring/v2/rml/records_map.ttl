@prefix : <https://w3id.org/italia/env/ld/rml/records_map.ttl#> .
@prefix rr: <http://www.w3.org/ns/r2rml#> .
@prefix crml: <http://w3id.org/stlab/crml#> .
@prefix rml: <http://semweb.mmlab.be/ns/rml#> .
@prefix ql: <http://semweb.mmlab.be/ns/ql#> .
@prefix ispra-place: <https://w3id.org/italia/env/onto/place/> .
@prefix ispra-top: <https://w3id.org/italia/env/onto/top/> .
@prefix inspire-mf: <https://w3id.org/italia/env/onto/inspire-mf/> .
@prefix dsw: <http://purl.org/dsw/> .
@prefix dwc: <http://rs.tdwg.org/dwc/terms/> .
@prefix dwciri: <http://rs.tdwg.org/dwc/iri/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix geo: <http://www.w3.org/2003/01/geo/wgs84_pos#> .
@prefix sem: <http://semanticweb.cs.vu.nl/2009/11/sem/> .
@prefix geosparql: <http://www.opengis.net/ont/geosparql#> .


:CSV_TOKEN
    rml:source "{{ csv_token }}" ;
    rml:referenceFormulation ql:CSV;
    crml:separator ";".

:DatasetISPRA
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}";
            rr:class ispra-top:Dataset
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "{{dataset.upper()}} Dataset";
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Euring Protocol Engine";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Euring Protocol Engine";
            rr:language "en"
        ]
    ].


:Observation
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/observation/{ {{COD_EVNV}} }_%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%_{ {{COD_CENTROID}} }";
        rr:class dsw:Token;
        rr:class inspire-mf:Observation
    ];

    rr:predicateObjectMap [
        rr:predicate ispra-top:isMemberOf;
        rr:objectMap [
            rr:parentTriplesMap :DatasetISPRA
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Cattura dell'esemplare { {{COD_EVNV}} }, nei pressi di { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Capture of the specimen { {{COD_EVNV}} }, near { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Marcatura o ritrovamento dell'esemplare { {{COD_EVNV}} } a seguito di cattura temporanea per l'inanellamento degli uccelli a scopo scientifico (art. 4, L. 157/92), nei pressi del toponimo { {{NAME_CENTROID}} } (elemento geografico { {{COD_CENTROID}} })";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Marking or discovery of the specimen { {{COD_EVNV}} } following temporary trapping for bird ringing for scientific purposes (art. 4, L. 157/92) near the { {{NAME_CENTROID}} } toponym (geographic element { {{COD_CENTROID}} })";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:created;
        rr:objectMap [
            rr:template "%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%";
            rr:datatype xsd:date
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate ispra-place:hasFeature;
        rr:objectMap [
            rr:parentTriplesMap :GeoFeature
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:locality;
        rr:objectMap [
            rr:template "{ {{NAME_CENTROID}} }"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:countryCode;
        rr:objectMap [
            rr:template "Italy"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:continent;
        rr:objectMap [
            rr:template "EU"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:derivedFrom;
        rr:objectMap [
            rr:parentTriplesMap :Organism
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:evidenceFor;
        rr:objectMap [
            rr:parentTriplesMap :Occurrence
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:isBasisForId;
        rr:objectMap [
            rr:parentTriplesMap :Identification
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate geo:lat;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LAT_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate geo:long;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LON_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ].
    

:Identification
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/identification/{ {{COD_EVNV}} }_%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%_{ {{COD_CENTROID}} }";
            rr:class dwc:Identification
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Esemplare { {{COD_EVNV}} } - specie/sottospecie %eval:format_euring('{ {{COD_ID}} }')%";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "The specimen { {{COD_EVNV}} } - species/subspecies %eval:format_euring('{ {{COD_ID}} }')%";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Riconoscimento dell'esemplare { {{COD_EVNV}} } come appartenente alla specie/sottospecie %eval:format_euring('{ {{COD_ID}} }')%";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Recognition of the specimen { {{COD_EVNV}} } as belonging to the species/subspecies %eval:format_euring('{ {{COD_ID}} }')%";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:identifies;
        rr:objectMap [
            rr:parentTriplesMap :Organism
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:dateIdentified;
        rr:objectMap [
            rr:template "%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%";
            rr:datatype xsd:date
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwciri:toTaxon;
        rr:objectMap [
            rr:parentTriplesMap :Taxon
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwciri:identifiedBy;
        rr:objectMap [
            rr:parentTriplesMap :Ispra
        ]
    ].


:Occurrence
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/occurrence/{ {{COD_EVNV}} }_%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%_{ {{COD_CENTROID}} }";
            rr:class dwc:Occurrence
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Esemplare { {{COD_EVNV}} } - data { {{DAY}} }-{ {{MONTH}} }-{ {{YEAR}} } - luogo { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "The specimen { {{COD_EVNV}} } - date { {{YEAR}} }-{ {{MONTH}} }-{ {{DAY}} } - place { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Presenza dell'esemplare { {{COD_EVNV}} } il { {{DAY}} }-{ {{MONTH}} }-{ {{YEAR}} } a { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dcterms:description;
        rr:objectMap [
            rr:template "Presence of the specimen { {{COD_EVNV}} } on { {{YEAR}} }-{ {{MONTH}} }-{ {{DAY}} } at { {{NAME_CENTROID}} } ({ {{COD_CENTROID}} })";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwciri:recordedBy;
        rr:objectMap [
            rr:parentTriplesMap :Ispra
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:occurrenceOf;
        rr:objectMap [
            rr:parentTriplesMap :Organism
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dsw:atEvent;
        rr:objectMap [
            rr:parentTriplesMap :Event
        ]
    ].


:Event
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/event/{ {{COD_EVNV}} }_%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%_{ {{COD_CENTROID}} }";
            rr:class dwc:Event;
            rr:class sem:Event
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Evento di cattura dell'esemplare { {{COD_EVNV}} } il { {{DAY}} }-{ {{MONTH}} }-{ {{YEAR}} } nel toponimo { {{COD_CENTROID}} } - { {{NAME_CENTROID}} }";
            rr:language "it"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate rdfs:label;
        rr:objectMap [
            rr:template  "Capture event of the specimen { {{COD_EVNV}} } on { {{YEAR}} }-{ {{MONTH}} }-{ {{DAY}} } in the toponym { {{COD_CENTROID}} } - { {{NAME_CENTROID}} }";
            rr:language "en"
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:eventDate;
        rr:objectMap [
            rr:template "%eval:format_date('{ {{DAY}} }', '{ {{MONTH}} }', '{ {{YEAR}} }')%";
            rr:datatype xsd:date
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate sem:eventType;
        rr:objectMap [
            rr:parentTriplesMap :Capture
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate dwc:locatedAt;
        rr:objectMap [
            rr:parentTriplesMap :Place
        ]
    ].


:Organism

    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/organism/00103_{ {{COD_EVNV}} }"
        ].


:Ispra

    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:constant "https://w3id.org/italia/env/ld/common/organisation/001"
        ].


:Place

    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
            rr:template "https://w3id.org/italia/env/ld/place/location/00102_{ {{COD_CENTROID}} }"
        ].

:GeoFeature
    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
        rr:template "https://w3id.org/italia/env/ld/{{dataset}}/place/%eval:digest('{ {{LON_CENTROID}} }{ {{LAT_CENTROID}} }')%";
	    rr:class ispra-place:Feature 
    ];

        rr:predicateObjectMap [
        rr:predicate geo:lat;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LAT_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate geo:long;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LON_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate ispra-place:hasGeometry;
	    rr:objectMap [
	        rr:parentTriplesMap :Geometry
	    ]
    ] .


:Geometry
  rml:logicalSource :CSV_TOKEN;
  
   rr:subjectMap [
     rr:template "https://w3id.org/italia/env/ld/{{dataset}}/geometry/%eval:digest('{ {{LON_CENTROID}} }{ {{LAT_CENTROID}} }')%";
     rr:class ispra-place:Geometry
   ];
  
   rr:predicateObjectMap [
     rr:predicate ispra-place:geometry;
     rr:objectMap [
    rr:template "%eval:get_point('{ {{LON_CENTROID}} }', '{ {{LAT_CENTROID}} }')%";
    rr:datatype geosparql:wktLiteral
     ]
   ];

    rr:predicateObjectMap [
        rr:predicate geo:lat;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LAT_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ];

    rr:predicateObjectMap [
        rr:predicate geo:long;
        rr:objectMap [
            rr:template "%eval:round_coord('{ {{LON_CENTROID}} }')%";
            rr:datatype xsd:decimal
        ]
    ].


:Taxon

    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
            rr:template "https://w3id.org/italia/env/ld/{{dataset}}/taxon/%eval:format_euring('{ {{COD_ID}} }')%"
        ].


:Capture

    rml:logicalSource :CSV_TOKEN;

    rr:subjectMap [
            rr:template "https://w3id.org/italia/env/vocab/euring/capture/{ {{RECAPTURE}} }"
        ].